<template>
  <div
    class="container mx-auto content-center p-3 bg-gray-50 shadow-md rounded-lg dark:bg-gray-900"
  >
    <div class="flex items-center justify-between mb-4">
      <div>
        <h1 v-if="!connected" class="font-semibold text-xl">
          Ambient Box not connected!
        </h1>
        <h1 v-else class="font-semibold text-xl">
          Ambient Box
        </h1>
      </div>
      <div class="flex items-center">
        <button v-if="!connected" class="focus:outline-none" @click="connect()">
          <svg class="w-6 h-8 bt-hover fill-current mr-2" viewBox="0 0 30 55">
            <path
              d="M 15.00,12.75 C 15.00,12.75 15.00,25.50 15.00,25.50 15.00,25.50 8.12,18.75 8.12,18.75 4.38,15.12 0.88,12.37 0.38,12.87 -0.12,13.37 2.62,16.88 6.25,20.62 6.25,20.62 13.00,27.50 13.00,27.50 13.00,27.50 6.25,34.38 6.25,34.38 2.62,38.12 -0.12,41.62 0.38,42.12 0.88,42.62 4.38,39.88 8.12,36.25 8.12,36.25 15.00,29.50 15.00,29.50 15.00,29.50 15.00,42.25 15.00,42.25 15.00,49.25 15.50,55.00 16.00,55.00 16.50,55.00 20.00,51.88 23.75,48.12 23.75,48.12 30.50,41.25 30.50,41.25 30.50,41.25 23.75,34.38 23.75,34.38 23.75,34.38 17.00,27.50 17.00,27.50 17.00,27.50 23.75,20.62 23.75,20.62 23.75,20.62 30.50,13.75 30.50,13.75 30.50,13.75 23.75,6.88 23.75,6.88 20.00,3.12 16.50,0.00 16.00,0.00 15.50,0.00 15.00,5.75 15.00,12.75 Z M 22.12,18.38 C 22.12,18.38 17.50,23.12 17.50,23.12 17.50,23.12 17.50,13.75 17.50,13.75 17.50,13.75 17.50,4.38 17.50,4.38 17.50,4.38 22.12,9.12 22.12,9.12 22.12,9.12 26.88,13.75 26.88,13.75 26.88,13.75 22.12,18.38 22.12,18.38 Z M 22.12,45.88 C 22.12,45.88 17.50,50.62 17.50,50.62 17.50,50.62 17.50,41.25 17.50,41.25 17.50,41.25 17.50,31.88 17.50,31.88 17.50,31.88 22.12,36.62 22.12,36.62 22.12,36.62 26.88,41.25 26.88,41.25 26.88,41.25 22.12,45.88 22.12,45.88 Z"
            ></path>
          </svg>
        </button>
        <button v-else class="focus:outline-none" @click="disconnect()">
          <svg class="w-6 h-8 fill-bt light-shadow mr-2" viewBox="0 0 30 55">
            <path
              d="M 15.00,12.75 C 15.00,12.75 15.00,25.50 15.00,25.50 15.00,25.50 8.12,18.75 8.12,18.75 4.38,15.12 0.88,12.37 0.38,12.87 -0.12,13.37 2.62,16.88 6.25,20.62 6.25,20.62 13.00,27.50 13.00,27.50 13.00,27.50 6.25,34.38 6.25,34.38 2.62,38.12 -0.12,41.62 0.38,42.12 0.88,42.62 4.38,39.88 8.12,36.25 8.12,36.25 15.00,29.50 15.00,29.50 15.00,29.50 15.00,42.25 15.00,42.25 15.00,49.25 15.50,55.00 16.00,55.00 16.50,55.00 20.00,51.88 23.75,48.12 23.75,48.12 30.50,41.25 30.50,41.25 30.50,41.25 23.75,34.38 23.75,34.38 23.75,34.38 17.00,27.50 17.00,27.50 17.00,27.50 23.75,20.62 23.75,20.62 23.75,20.62 30.50,13.75 30.50,13.75 30.50,13.75 23.75,6.88 23.75,6.88 20.00,3.12 16.50,0.00 16.00,0.00 15.50,0.00 15.00,5.75 15.00,12.75 Z M 22.12,18.38 C 22.12,18.38 17.50,23.12 17.50,23.12 17.50,23.12 17.50,13.75 17.50,13.75 17.50,13.75 17.50,4.38 17.50,4.38 17.50,4.38 22.12,9.12 22.12,9.12 22.12,9.12 26.88,13.75 26.88,13.75 26.88,13.75 22.12,18.38 22.12,18.38 Z M 22.12,45.88 C 22.12,45.88 17.50,50.62 17.50,50.62 17.50,50.62 17.50,41.25 17.50,41.25 17.50,41.25 17.50,31.88 17.50,31.88 17.50,31.88 22.12,36.62 22.12,36.62 22.12,36.62 26.88,41.25 26.88,41.25 26.88,41.25 22.12,45.88 22.12,45.88 Z"
            ></path>
          </svg>
        </button>
        <div v-if="sensorData.battery === 3">
          <button class="focus:outline-none" @click="toggleDarkMode()">
            <svg class="w-8 h-10 fill-charging" viewBox="0 0 55 30">
              <path
                d="M 18.75,11.38 C 18.75,11.38 10.62,14.87 10.62,14.87   10.62,14.87 16.38,15.00 16.38,15.00   21.38,15.00 22.25,15.37 23.88,18.62   23.88,18.62 25.62,22.25 25.62,22.25   25.62,22.25 33.75,19.00 33.75,19.00   33.75,19.00 41.75,15.62 41.75,15.62   41.75,15.62 36.12,15.25 36.12,15.25   31.25,14.87 30.12,14.38 28.63,11.38   28.63,11.38 26.88,7.88 26.88,7.88   26.88,7.88 18.75,11.38 18.75,11.38 Z M 1.50,1.50 C -0.50,3.50 -0.50,26.50 1.50,28.50   3.63,30.62 48.88,30.62 51.00,28.50   51.88,27.62 52.50,25.50 52.50,23.62   52.50,21.75 53.12,19.75 53.75,19.38   54.50,19.00 55.00,17.00 55.00,15.00   55.00,13.00 54.50,11.00 53.75,10.62   53.12,10.25 52.50,8.25 52.50,6.37   52.50,4.50 51.88,2.37 51.00,1.50   48.88,-0.62 3.63,-0.62 1.50,1.50 Z M 49.38,15.00 C 49.38,15.00 49.38,26.88 49.38,26.88   49.38,26.88 26.25,26.88 26.25,26.88   26.25,26.88 3.12,26.88 3.12,26.88   3.12,26.88 2.75,16.38 2.75,16.38   2.50,10.62 2.62,5.12 3.00,4.12   3.63,2.75 8.25,2.50 26.50,2.75   26.50,2.75 49.38,3.12 49.38,3.12   49.38,3.12 49.38,15.00 49.38,15.00 Z"
              ></path>
            </svg>
          </button>
        </div>
        <div v-else-if="sensorData.battery === 2">
          <button class="focus:outline-none" @click="toggleDarkMode()">
            <svg class="w-8 h-10 fill-current" viewBox="0 0 55 30">
              <path
                d="M 5.00,15.00 C 5.00,15.00 5.00,25.00 5.00,25.00   5.00,25.00 26.25,25.00 26.25,25.00   26.25,25.00 47.50,25.00 47.50,25.00   47.50,25.00 47.50,15.00 47.50,15.00   47.50,15.00 47.50,5.00 47.50,5.00   47.50,5.00 26.25,5.00 26.25,5.00   26.25,5.00 5.00,5.00 5.00,5.00   5.00,5.00 5.00,15.00 5.00,15.00 Z M 1.50,1.50 C -0.50,3.50 -0.50,26.50 1.50,28.50   3.63,30.62 48.88,30.62 51.00,28.50   51.88,27.62 52.50,25.50 52.50,23.62   52.50,21.75 53.12,19.75 53.75,19.38   54.50,19.00 55.00,17.00 55.00,15.00   55.00,13.00 54.50,11.00 53.75,10.62   53.12,10.25 52.50,8.25 52.50,6.37   52.50,4.50 51.88,2.37 51.00,1.50   48.88,-0.62 3.63,-0.62 1.50,1.50 Z M 49.38,15.00 C 49.38,15.00 49.38,26.88 49.38,26.88   49.38,26.88 26.25,26.88 26.25,26.88   26.25,26.88 3.12,26.88 3.12,26.88   3.12,26.88 2.75,16.38 2.75,16.38   2.50,10.62 2.62,5.12 3.00,4.12   3.63,2.75 8.25,2.50 26.50,2.75   26.50,2.75 49.38,3.12 49.38,3.12   49.38,3.12 49.38,15.00 49.38,15.00 Z"
              ></path>
            </svg>
          </button>
        </div>
        <div v-else-if="sensorData.battery === 1">
          <button class="focus:outline-none" @click="toggleDarkMode()">
            <svg class="w-8 h-10 fill-current" viewBox="0 0 55 30">
              <path
                d="M 5.00,15.00 C 5.00,15.00 5.00,25.00 5.00,25.00   5.00,25.00 21.25,25.00 21.25,25.00   21.25,25.00 37.50,25.00 37.50,25.00   37.50,25.00 37.50,15.00 37.50,15.00   37.50,15.00 37.50,5.00 37.50,5.00   37.50,5.00 21.25,5.00 21.25,5.00   21.25,5.00 5.00,5.00 5.00,5.00   5.00,5.00 5.00,15.00 5.00,15.00 Z M 1.50,1.50 C -0.50,3.50 -0.50,26.50 1.50,28.50   3.63,30.62 48.88,30.62 51.00,28.50   51.88,27.62 52.50,25.50 52.50,23.62   52.50,21.75 53.12,19.75 53.75,19.38   54.50,19.00 55.00,17.00 55.00,15.00   55.00,13.00 54.50,11.00 53.75,10.62   53.12,10.25 52.50,8.25 52.50,6.37   52.50,4.50 51.88,2.37 51.00,1.50   48.88,-0.62 3.63,-0.62 1.50,1.50 Z M 49.38,15.00 C 49.38,15.00 49.38,26.88 49.38,26.88   49.38,26.88 26.25,26.88 26.25,26.88   26.25,26.88 3.12,26.88 3.12,26.88   3.12,26.88 2.75,16.38 2.75,16.38   2.50,10.62 2.62,5.12 3.00,4.12   3.63,2.75 8.25,2.50 26.50,2.75   26.50,2.75 49.38,3.12 49.38,3.12   49.38,3.12 49.38,15.00 49.38,15.00 Z"
              ></path>
            </svg>
          </button>
        </div>
        <div v-else-if="sensorData.battery === 0">
          <button class="focus:outline-none" @click="toggleDarkMode()">
            <svg class="w-8 h-10 fill-red" viewBox="0 0 55 30">
              <path
                d="M 5.00,15.00 C 5.00,15.00 5.00,25.00 5.00,25.00   5.00,25.00 11.25,25.00 11.25,25.00   11.25,25.00 17.50,25.00 17.50,25.00   17.50,25.00 17.50,15.00 17.50,15.00   17.50,15.00 17.50,5.00 17.50,5.00   17.50,5.00 11.25,5.00 11.25,5.00   11.25,5.00 5.00,5.00 5.00,5.00   5.00,5.00 5.00,15.00 5.00,15.00 Z M 1.50,1.50 C -0.50,3.50 -0.50,26.50 1.50,28.50   3.63,30.62 48.88,30.62 51.00,28.50   51.88,27.62 52.50,25.50 52.50,23.62   52.50,21.75 53.12,19.75 53.75,19.38   54.50,19.00 55.00,17.00 55.00,15.00   55.00,13.00 54.50,11.00 53.75,10.62   53.12,10.25 52.50,8.25 52.50,6.37   52.50,4.50 51.88,2.37 51.00,1.50   48.88,-0.62 3.63,-0.62 1.50,1.50 Z M 49.38,15.00 C 49.38,15.00 49.38,26.88 49.38,26.88   49.38,26.88 26.25,26.88 26.25,26.88   26.25,26.88 3.12,26.88 3.12,26.88   3.12,26.88 2.75,16.38 2.75,16.38   2.50,10.62 2.62,5.12 3.00,4.12   3.63,2.75 8.25,2.50 26.50,2.75   26.50,2.75 49.38,3.12 49.38,3.12   49.38,3.12 49.38,15.00 49.38,15.00 Z"
              ></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div class="flex items-center justify-between my-2">
      <div class="flex items-center">
        <svg class="w-8 h-8 m-auto fill-current" viewBox="0 0 20 20">
          <path
            d="M10.867,12.751V7.4c0-0.478-0.388-0.866-0.866-0.866S9.134,6.923,9.134,7.4v5.351c-1.008,0.357-1.733,1.316-1.733,2.448c0,1.436,1.164,2.599,2.6,2.599c1.435,0,2.599-1.163,2.599-2.599C12.6,14.067,11.876,13.108,10.867,12.751 M12.6,11.739V3.068c0-1.436-1.164-2.6-2.599-2.6c-1.436,0-2.6,1.164-2.6,2.6v8.671c-1.05,0.79-1.733,2.044-1.733,3.46c0,2.393,1.939,4.332,4.333,4.332c2.392,0,4.333-1.939,4.333-4.332C14.333,13.783,13.65,12.529,12.6,11.739 M10,18.665c-1.914,0-3.466-1.552-3.466-3.466c0-1.282,0.698-2.399,1.733-2.999V3.068c0-0.957,0.776-1.733,1.733-1.733s1.733,0.776,1.733,1.733V12.2c1.035,0.6,1.732,1.717,1.732,2.999C13.466,17.113,11.914,18.665,10,18.665"
          ></path>
        </svg>
        <div class="text-xl ml-1">Temperature</div>
      </div>
      <div class="text-2xl font-semibold">
        {{ sensorData.temperature ? sensorData.temperature + `Â°C` : "" }}
      </div>
    </div>
    <div class="flex items-center justify-between my-2">
      <div class="flex items-center">
        <svg class="w-8 h-8 m-auto fill-current" viewBox="0 0 20 20">
          <path
            d="M10,16.513c-2.249,0-4.071-1.822-4.071-4.07c0-0.226-0.182-0.407-0.407-0.407c-0.225,0-0.407,0.182-0.407,0.407c0,2.697,2.187,4.885,4.885,4.885c0.225,0,0.407-0.183,0.407-0.407S10.225,16.513,10,16.513M10,1.044c-0.814,0-6.513,6.92-6.513,11.398c0,3.597,2.916,6.513,6.513,6.513c3.597,0,6.513-2.916,6.513-6.513C16.513,7.964,10.813,1.044,10,1.044 M10,18.141c-3.148,0-5.699-2.65-5.699-5.92C4.301,8.372,9.593,2.011,10,2.011c0.407,0,5.698,6.36,5.698,10.209C15.698,15.49,13.147,18.141,10,18.141"
          ></path>
        </svg>
        <div class="text-xl ml-1">Humidity</div>
      </div>
      <div class="text-2xl font-semibold">
        {{ sensorData.humidity ? sensorData.humidity + `%` : "" }}
      </div>
    </div>
    <div class="flex items-center justify-between my-2">
      <div class="flex items-center">
        <svg class="w-8 h-8 m-auto fill-current" viewBox="0 0 1000 1000">
          <path
            d="M 66.20,704.60
           C 66.20,704.60 349.00,270.90 349.00,270.90 358.40,256.50 379.70,257.50 387.80,272.70 387.80,272.70 446.20,383.00 446.20,383.00 455.00,399.60 479.10,398.80 486.70,381.60 486.70,381.60 513.10,321.80 513.10,321.80 520.50,305.20 543.50,303.70 552.90,319.20 552.90,319.20 674.00,517.50 674.00,517.50 680.80,528.70 695.70,531.70 706.40,524.10 706.40,524.10 737.90,501.50 737.90,501.50 747.50,494.60 760.80,496.30 768.40,505.40 768.40,505.40 932.30,702.50 932.30,702.50 944.50,717.20 934.10,739.40 915.00,739.40 915.00,739.40 85.10,739.40 85.10,739.40 67.10,739.40 56.40,719.60 66.20,704.60 Z"
          />
        </svg>
        <div class="text-xl ml-1">Altitude</div>
      </div>
      <div class="text-2xl font-semibold">
        {{ sensorData.altitude ? sensorData.altitude + `m` : "" }}
      </div>
    </div>
    <div class="flex items-center justify-between my-2">
      <div class="flex items-center">
        <svg class="w-8 h-8 m-auto fill-current" viewBox="0 0 1000 1000">
          <path
            d="M 861.40,445.10 C 840.90,428.40 832.60,411.00 829.20,385.00 817.40,296.00 766.00,234.00 683.60,202.60 597.90,170.10 514.20,179.20 442.30,240.40 426.60,253.70 412.20,260.90 394.40,262.70 360.10,220.70 307.90,194.00 249.60,194.00 146.30,194.00 62.50,277.80 62.50,381.10 62.50,426.80 78.80,468.40 105.80,500.80 75.10,553.10 68.70,614.30 90.00,675.50 120.00,762.10 197.40,815.60 293.50,815.70 365.20,815.80 436.80,815.70 508.40,815.70 581.40,815.70 654.40,816.00 727.30,815.70 817.30,815.30 895.20,760.60 924.90,677.40 954.80,593.60 930.90,501.70 861.40,445.10 Z M -301.70,559.60 C -392.40,633.20 -466.00,723.90 -466.00,610.90 -466.00,708.00 -442.50,738.10 -405.60,618.00 -396.90,631.40 -387.40,636.80 -377.10,625.80 -361.90,639.10 -345.00,641.90 -327.40,627.10 -319.10,629.20 -310.40,629.20 -301.70,627.10 -211.00,553.70 -137.50,462.90 -137.50,598.10 -137.50,541.90 -144.90,518.30 -158.20,588.20 -163.70,569.10 -170.20,560.70 -177.40,581.30 -183.30,568.10 -189.70,562.20 -196.60,557.70 -225.00,519.80 -261.70,519.80 -301.70,519.80 -301.70,519.80 -301.70,559.60 -301.70,559.60 Z M 899.40,620.30 C 875.50,696.10 807.50,745.80 725.80,746.20 654.30,746.50 582.60,746.20 511.10,746.20 438.20,746.20 365.40,746.30 292.40,746.20 208.00,745.90 139.30,696.70 115.50,619.60 100.60,571.40 105.50,524.00 127.50,482.90 137.10,491.20 147.60,498.60 158.80,504.80 144.20,533.60 140.60,566.40 149.50,601.00 166.50,667.40 221.20,708.00 294.60,708.00 435.40,708.10 576.30,708.10 717.10,708.00 793.40,708.00 849.50,667.40 866.10,600.70 882.70,533.80 851.50,471.40 785.30,434.90 775.80,429.70 765.50,415.40 765.80,405.60 768.20,316.30 728.10,249.00 654.70,223.40 572.70,195.00 499.50,221.60 445.90,299.40 443.10,303.40 439.70,307.10 435.30,312.60 435.30,312.60 434.40,312.20 434.40,312.20 431.30,292.10 424.90,273.00 416.10,255.60 427.00,253.50 436.30,247.60 447.00,236.50 511.00,171.00 590.60,158.80 673.10,190.50 751.90,220.80 798.30,282.00 801.50,369.00 802.40,392.50 810.50,405.10 829.30,417.90 896.40,464.10 923.20,544.20 899.40,620.30 Z M 157.30,316.70 C 160.80,313.20 166.50,313.20 170.00,316.70 170.00,316.70 220.70,367.40 220.70,367.40 220.70,367.40 220.70,230.80 220.70,230.80 220.70,225.80 224.70,221.80 229.70,221.80 229.70,221.80 265.70,221.80 265.70,221.80 270.70,221.80 274.70,225.80 274.70,230.80 274.70,230.80 274.70,371.20 274.70,371.20 274.70,371.20 329.20,316.70 329.20,316.70 332.70,313.20 338.40,313.20 341.90,316.70 341.90,316.70 363.20,338.00 363.20,338.00 366.70,341.50 366.70,347.20 363.20,350.70 363.20,350.70 255.90,458.00 255.90,458.00 252.40,461.50 246.70,461.50 243.20,458.00 243.20,458.00 135.90,350.80 135.90,350.80 132.40,347.30 132.40,341.60 135.90,338.10 135.90,338.10 157.30,316.70 157.30,316.70 157.30,316.70 157.30,316.70 157.30,316.70 Z"
          />
        </svg>
        <div class="text-xl ml-1">Pressure</div>
      </div>
      <div class="text-2xl font-semibold">
        {{ sensorData.pressure ? sensorData.pressure + `Pa` : "" }}
      </div>
    </div>
    <div class="flex items-center justify-between my-2">
      <div class="flex items-center">
        <svg class="w-8 h-8 m-auto fill-current" viewBox="0 0 1000 1000">
          <path
            d="M 886.30,625.20 C 832.70,573.10 769.10,558.30 698.00,584.30   684.70,589.20 679.40,589.60 673.30,574.30   627.00,459.10 519.30,395.50 396.90,409.80   285.00,422.80 196.90,511.30 176.20,631.00   175.00,638.20 176.00,647.20 167.30,650.90   147.40,659.30 131.80,671.20 119.00,685.50   119.00,685.50 118.90,685.20 118.90,685.20   118.90,685.20 25.00,774.00 116.80,876.50   119.30,879.50 121.90,882.50 124.60,885.20   125.10,885.70 125.40,886.10 125.80,886.50   125.80,886.50 125.90,886.30 125.90,886.30   148.20,907.70 176.70,920.60 211.70,923.80   247.50,927.10 283.80,924.00 319.80,925.00   319.80,925.00 630.30,924.50 630.30,924.50   677.60,924.50 720.30,925.70 762.90,924.20   838.20,921.60 892.50,885.30 922.90,816.40   951.60,751.30 937.40,674.90 886.30,625.20 Z M 627.70,208.80 C 642.20,209.70 656.50,196.80 657.40,182.10   658.30,167.50 645.60,153.40 630.60,152.60   615.80,151.80 601.80,164.20 600.90,179.20   600.10,193.60 613.10,207.90 627.70,208.80 Z M 806.90,452.50 C 791.90,452.30 778.50,465.20 778.30,480.10   778.10,494.70 791.50,508.40 806.20,508.60   820.90,508.80 834.60,495.50 834.80,480.80   835.00,465.90 821.90,452.70 806.90,452.50 Z M 730.50,263.60 C 745.10,263.90 758.90,250.60 759.20,235.90   759.50,221.30 746.30,207.80 731.30,207.50   716.30,207.20 702.80,220.20 702.70,235.10   702.50,249.80 715.70,263.30 730.50,263.60 Z M 170.00,129.60 C 186.20,129.80 198.30,118.00 198.20,102.10   198.10,86.50 185.50,74.00 169.80,74.70   153.20,75.40 144.00,84.80 143.00,101.20   142.00,117.40 153.90,129.50 170.00,129.60 Z M 564.90,166.60 C 581.10,165.40 590.70,156.30 591.50,139.60   592.30,123.50 580.30,111.30 564.30,111.20   548.40,111.10 536.40,123.20 536.60,139.20   536.70,155.00 549.30,167.80 564.90,166.60 Z M 310.50,281.40 C 326.40,280.90 338.20,268.20 337.40,252.50   336.60,236.90 323.60,225.30 307.60,226.60   290.90,228.00 282.40,238.00 282.00,254.30   281.80,270.30 294.40,281.90 310.50,281.40 Z M 218.10,407.90 C 234.00,409.30 247.40,398.30 248.70,382.80   250.00,367.20 238.60,353.80 222.70,353.20   206.10,352.60 196.00,360.70 193.70,377.20   191.40,393.20 202.40,406.50 218.10,407.90 Z M 786.40,390.90 C 801.70,390.50 814.70,377.00 813.90,362.10   813.10,346.70 799.70,334.80 783.90,336.00   766.90,337.20 758.60,347.90 757.60,363.60   756.60,378.50 771.00,391.30 786.40,390.90 Z M 562.10,350.10 C 562.60,365.40 576.30,379.00 591.10,377.20   606.90,375.30 616.80,366.30 617.20,349.50   617.60,333.90 604.60,320.80 589.50,321.00   574.40,321.20 561.60,334.80 562.10,350.10 Z M 391.50,328.00 C 391.80,344.60 401.20,354.20 417.20,356.30   431.80,358.20 446.20,344.80 447.10,329.80   448.00,314.70 435.40,301.00 420.00,300.40   404.70,299.80 391.20,312.40 391.50,328.00 Z M 118.00,234.70 C 117.50,218.50 109.00,208.40 92.20,207.10   76.10,205.90 63.20,217.50 62.50,233.10   61.80,248.40 74.10,261.50 89.60,262.00   105.50,262.50 118.50,250.50 118.00,234.70 Z M 502.60,242.70 C 518.80,241.10 528.10,231.80 528.60,215.10   529.00,199.20 516.60,187.10 500.70,187.40   484.90,187.70 472.90,200.30 473.40,216.00   473.90,231.30 487.40,244.20 502.60,242.70 Z M 384.60,202.90 C 399.80,204.80 413.20,192.00 413.80,176.40   414.40,160.80 402.30,147.50 387.10,147.00   371.90,146.50 358.90,159.30 359.00,174.90   359.00,191.90 368.70,200.90 384.60,202.90 Z M 846.80,168.30 C 863.30,167.50 872.80,158.40 873.90,141.90   875.00,126.50 862.30,113.20 846.90,112.80   831.30,112.40 818.90,124.70 818.80,140.60   818.80,156.60 830.90,169.00 846.80,168.30 Z M 90.40,433.80 C 88.60,448.60 102.20,462.30 117.50,462.70   132.80,463.10 146.40,450.40 146.70,435.40   147.00,420.40 133.80,407.50 118.20,407.70   101.20,408.00 92.40,418.10 90.40,433.80   90.40,433.80 90.40,433.80 90.40,433.80 Z"
          />
        </svg>
        <div class="text-xl ml-1">IAQ</div>
      </div>
      <div class="text-2xl font-semibold">{{ getIaqText(sensorData.iaq) }}</div>
    </div>
    <div class="flex items-center justify-between my-2">
      <div class="flex items-center">
        <svg class="w-8 h-8 m-auto fill-current" viewBox="0 0 1000 1000">
          <path
            d="M 886.30,625.20 C 832.70,573.10 769.10,558.30 698.00,584.30   684.70,589.20 679.40,589.60 673.30,574.30   627.00,459.10 519.30,395.50 396.90,409.80   285.00,422.80 196.90,511.30 176.20,631.00   175.00,638.20 176.00,647.20 167.30,650.90   147.40,659.30 131.80,671.20 119.00,685.50   119.00,685.50 118.90,685.20 118.90,685.20   118.90,685.20 25.00,774.00 116.80,876.50   119.30,879.50 121.90,882.50 124.60,885.20   125.10,885.70 125.40,886.10 125.80,886.50   125.80,886.50 125.90,886.30 125.90,886.30   148.20,907.70 176.70,920.60 211.70,923.80   247.50,927.10 283.80,924.00 319.80,925.00   319.80,925.00 630.30,924.50 630.30,924.50   677.60,924.50 720.30,925.70 762.90,924.20   838.20,921.60 892.50,885.30 922.90,816.40   951.60,751.30 937.40,674.90 886.30,625.20 Z M 627.70,208.80 C 642.20,209.70 656.50,196.80 657.40,182.10   658.30,167.50 645.60,153.40 630.60,152.60   615.80,151.80 601.80,164.20 600.90,179.20   600.10,193.60 613.10,207.90 627.70,208.80 Z M 806.90,452.50 C 791.90,452.30 778.50,465.20 778.30,480.10   778.10,494.70 791.50,508.40 806.20,508.60   820.90,508.80 834.60,495.50 834.80,480.80   835.00,465.90 821.90,452.70 806.90,452.50 Z M 730.50,263.60 C 745.10,263.90 758.90,250.60 759.20,235.90   759.50,221.30 746.30,207.80 731.30,207.50   716.30,207.20 702.80,220.20 702.70,235.10   702.50,249.80 715.70,263.30 730.50,263.60 Z M 170.00,129.60 C 186.20,129.80 198.30,118.00 198.20,102.10   198.10,86.50 185.50,74.00 169.80,74.70   153.20,75.40 144.00,84.80 143.00,101.20   142.00,117.40 153.90,129.50 170.00,129.60 Z M 564.90,166.60 C 581.10,165.40 590.70,156.30 591.50,139.60   592.30,123.50 580.30,111.30 564.30,111.20   548.40,111.10 536.40,123.20 536.60,139.20   536.70,155.00 549.30,167.80 564.90,166.60 Z M 310.50,281.40 C 326.40,280.90 338.20,268.20 337.40,252.50   336.60,236.90 323.60,225.30 307.60,226.60   290.90,228.00 282.40,238.00 282.00,254.30   281.80,270.30 294.40,281.90 310.50,281.40 Z M 218.10,407.90 C 234.00,409.30 247.40,398.30 248.70,382.80   250.00,367.20 238.60,353.80 222.70,353.20   206.10,352.60 196.00,360.70 193.70,377.20   191.40,393.20 202.40,406.50 218.10,407.90 Z M 786.40,390.90 C 801.70,390.50 814.70,377.00 813.90,362.10   813.10,346.70 799.70,334.80 783.90,336.00   766.90,337.20 758.60,347.90 757.60,363.60   756.60,378.50 771.00,391.30 786.40,390.90 Z M 562.10,350.10 C 562.60,365.40 576.30,379.00 591.10,377.20   606.90,375.30 616.80,366.30 617.20,349.50   617.60,333.90 604.60,320.80 589.50,321.00   574.40,321.20 561.60,334.80 562.10,350.10 Z M 391.50,328.00 C 391.80,344.60 401.20,354.20 417.20,356.30   431.80,358.20 446.20,344.80 447.10,329.80   448.00,314.70 435.40,301.00 420.00,300.40   404.70,299.80 391.20,312.40 391.50,328.00 Z M 118.00,234.70 C 117.50,218.50 109.00,208.40 92.20,207.10   76.10,205.90 63.20,217.50 62.50,233.10   61.80,248.40 74.10,261.50 89.60,262.00   105.50,262.50 118.50,250.50 118.00,234.70 Z M 502.60,242.70 C 518.80,241.10 528.10,231.80 528.60,215.10   529.00,199.20 516.60,187.10 500.70,187.40   484.90,187.70 472.90,200.30 473.40,216.00   473.90,231.30 487.40,244.20 502.60,242.70 Z M 384.60,202.90 C 399.80,204.80 413.20,192.00 413.80,176.40   414.40,160.80 402.30,147.50 387.10,147.00   371.90,146.50 358.90,159.30 359.00,174.90   359.00,191.90 368.70,200.90 384.60,202.90 Z M 846.80,168.30 C 863.30,167.50 872.80,158.40 873.90,141.90   875.00,126.50 862.30,113.20 846.90,112.80   831.30,112.40 818.90,124.70 818.80,140.60   818.80,156.60 830.90,169.00 846.80,168.30 Z M 90.40,433.80 C 88.60,448.60 102.20,462.30 117.50,462.70   132.80,463.10 146.40,450.40 146.70,435.40   147.00,420.40 133.80,407.50 118.20,407.70   101.20,408.00 92.40,418.10 90.40,433.80   90.40,433.80 90.40,433.80 90.40,433.80 Z"
          />
        </svg>
        <div class="text-xl ml-1">IAQ accuracy</div>
      </div>
      <div class="text-2xl font-semibold">
        {{ getIaqAccuracyText(sensorData.iaqAccuracy) }}
      </div>
    </div>
  </div>
</template>

<script lang="ts">
/// <reference types="web-bluetooth" />
import { Component, Vue } from "vue-property-decorator";
import {
  IAQAccuracy,
  IAQState,
  BatteryLevel,
  SensorData
} from "@/interfaces/SensorData";

const serviceId = "83613d85-967c-4a59-8190-e39097cf9a72";
const characteristicId = "0db3cc41-1fe7-49fc-9552-84df888df33b";

@Component
export default class HelloWorld extends Vue {
  private bluetoothDevice?: BluetoothDevice;
  private connected = false;
  private darkMode = false;
  private sensorData: SensorData = {
    temperature: "",
    humidity: "",
    altitude: "",
    pressure: "",
    iaq: IAQState.UNKNOWN,
    iaqAccuracy: IAQAccuracy.UNKNOWN,
    battery: BatteryLevel.UNKNOWN
  };

  private dec = new TextDecoder("utf-8");

  connect() {
    const options = {
      filters: [{ services: [serviceId] }, { name: "Ambient Box" }]
    };

    navigator.bluetooth
      .requestDevice(options)
      .then(device => {
        this.bluetoothDevice = device;
        device.addEventListener("gattserverdisconnected", this.onDisconnected);
        return device.gatt?.connect();
      })
      .then(server => server?.getPrimaryService(serviceId))
      .then(service => service?.getCharacteristic(characteristicId))
      .then(characteristic => characteristic?.startNotifications())
      .then(characteristic => {
        characteristic?.addEventListener(
          "characteristicvaluechanged",
          this.handleCharacteristicValueChanged
        );
        this.connected = true;
      })
      .catch(error => {
        console.error(error);
      });
  }

  disconnect() {
    if (!this.bluetoothDevice) {
      return;
    }

    if (this.bluetoothDevice?.gatt?.connected) {
      this.bluetoothDevice?.gatt.disconnect();
    }
  }

  handleCharacteristicValueChanged(event: any) {
    let data = event.target.value;
    data = data.buffer ? data : new DataView(data);
    this.parseByteValues(data);

    console.log(this.sensorData);

    // this.parseJson(data);
  }

  parseByteValues(data: any) {
    this.sensorData.temperature = data.getFloat32(0, true).toFixed(1);
    this.sensorData.humidity = data.getFloat32(4, true).toFixed(1);
    this.sensorData.pressure = data.getFloat32(8, true);
    this.sensorData.altitude = data.getInt16(12, true);
    this.sensorData.iaq = data.getInt8(14, true);
    this.sensorData.iaqAccuracy = data.getInt8(15, true);
    this.sensorData.battery = data.getInt8(16, true);
  }

  parseJson(data: any) {
    const value = JSON.parse(this.dec.decode(data));
    this.sensorData.temperature = value.temperature;
    this.sensorData.humidity = value.humidity;
    this.sensorData.altitude = value.altitude;
    this.sensorData.pressure = value.pressure;
    this.sensorData.iaq = value.iaq;
    this.sensorData.iaqAccuracy = value.iaqAccuracy;
    this.sensorData.battery = value.battery;
  }

  onDisconnected(event: any) {
    const device = event.target;
    this.connected = false;
    console.log(`${device.name} disconnected.`);
  }

  toggleDarkMode() {
    if (!this.darkMode) {
      document.body.classList.add("dark");
      document
        .querySelector('meta[name="theme-color"]')
        ?.setAttribute("content", "#000");
    } else {
      document.body.classList.remove("dark");
      document
        .querySelector('meta[name="theme-color"]')
        ?.setAttribute("content", "#F3F4F6");
    }
    this.darkMode = !this.darkMode;
  }

  getIaqText(iaq: IAQState) {
    switch (iaq) {
      case IAQState.GREAT:
        return "Great";
      case IAQState.GOOD:
        return "Good";
      case IAQState.BAD:
        return "Bad";
      case IAQState.HORRIBLE:
        return "Horrible";
    }
  }

  getIaqAccuracyText(iaqAccuracy: IAQAccuracy) {
    switch (iaqAccuracy) {
      case IAQAccuracy.STABILIZING:
        return "Stabilizing";
      case IAQAccuracy.LOW:
        return "Low";
      case IAQAccuracy.MEDIUM:
        return "Medium";
      case IAQAccuracy.HIGH:
        return "High";
    }
  }
}
</script>

<style>
.fill-bt {
  fill: rgba(59, 130, 246, var(--tw-bg-opacity));
}

.bt-hover:hover {
  fill: rgba(191, 219, 254, var(--tw-bg-opacity));
}

.fill-charging {
  fill: rgba(3, 252, 107, var(--tw-bg-opacity));
}

.fill-red {
  fill: rgba(224, 0, 0, var(--tw-bg-opacity));
}

.light-shadow {
  filter: drop-shadow(0px 0px 3px rgba(147, 197, 253, var(--tw-bg-opacity)));
}
</style>
